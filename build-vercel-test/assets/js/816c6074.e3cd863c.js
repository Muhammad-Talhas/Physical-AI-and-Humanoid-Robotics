"use strict";(globalThis.webpackChunkphysical_ai_humanoid_robotics_textbook=globalThis.webpackChunkphysical_ai_humanoid_robotics_textbook||[]).push([[800],{252:(e,o,n)=>{n.r(o),n.d(o,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>s,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"chapters/gazebo-unity/ch6-basic-robot-control","title":"Basic Robot Control in Simulation","description":"Learning Objectives","source":"@site/docs/chapters/gazebo-unity/ch6-basic-robot-control.mdx","sourceDirName":"chapters/gazebo-unity","slug":"/chapters/gazebo-unity/ch6-basic-robot-control","permalink":"/docs/chapters/gazebo-unity/ch6-basic-robot-control","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"id":"ch6-basic-robot-control","title":"Basic Robot Control in Simulation","sidebar_label":"Basic Robot Control"},"sidebar":"textbookSidebar","previous":{"title":"Robot Modeling and Control","permalink":"/docs/chapters/gazebo-unity/ch5-robot-modeling"},"next":{"title":"Introduction to Isaac Sim","permalink":"/docs/chapters/nvidia-isaac/ch7-introduction-to-isaac-sim"}}');var t=n(4848),i=n(8453);const s={id:"ch6-basic-robot-control",title:"Basic Robot Control in Simulation",sidebar_label:"Basic Robot Control"},l=void 0,c={},a=[{value:"Learning Objectives",id:"learning-objectives",level:2},{value:"Overview",id:"overview",level:2},{value:"Robot Control Architectures",id:"robot-control-architectures",level:2},{value:"Open-Loop Control",id:"open-loop-control",level:3},{value:"Closed-Loop Control (Feedback Control)",id:"closed-loop-control-feedback-control",level:3},{value:"ROS 2 Control Stack in Gazebo",id:"ros-2-control-stack-in-gazebo",level:2},{value:"Key Components",id:"key-components",level:3},{value:"Example: Differential Drive Robot Control (Conceptual)",id:"example-differential-drive-robot-control-conceptual",level:3},{value:"Implementing Basic Open-Loop Control",id:"implementing-basic-open-loop-control",level:2},{value:"Sending Velocity Commands (Conceptual ROS 2 Publisher)",id:"sending-velocity-commands-conceptual-ros-2-publisher",level:3},{value:"Utilizing ROS 2 Controllers in Gazebo",id:"utilizing-ros-2-controllers-in-gazebo",level:2},{value:"Steps for Controller Integration (Conceptual)",id:"steps-for-controller-integration-conceptual",level:3},{value:"Interpreting Sensor Feedback for Simple Closed-Loop Control",id:"interpreting-sensor-feedback-for-simple-closed-loop-control",level:2},{value:"Odometry Subscriber (Conceptual ROS 2 Subscriber)",id:"odometry-subscriber-conceptual-ros-2-subscriber",level:3},{value:"Summary",id:"summary",level:2},{value:"Exercises",id:"exercises",level:2}];function d(e){const o={code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.h2,{id:"learning-objectives",children:"Learning Objectives"}),"\n",(0,t.jsxs)(o.ul,{children:["\n",(0,t.jsx)(o.li,{children:"Understand the concepts of robot control architectures."}),"\n",(0,t.jsx)(o.li,{children:"Implement basic open-loop control for simulated robots."}),"\n",(0,t.jsx)(o.li,{children:"Utilize ROS 2 controllers for joint and mobile robot control in Gazebo."}),"\n",(0,t.jsx)(o.li,{children:"Interpret sensor feedback for simple closed-loop control."}),"\n"]}),"\n",(0,t.jsx)(o.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsx)(o.p,{children:"Controlling a robot involves translating desired behaviors into commands that its actuators can execute. This chapter focuses on fundamental robot control concepts within a simulation environment. We will explore both open-loop and simple closed-loop control strategies, leveraging ROS 2 and Gazebo for practical implementation of simulated robot control."}),"\n",(0,t.jsx)(o.h2,{id:"robot-control-architectures",children:"Robot Control Architectures"}),"\n",(0,t.jsx)(o.p,{children:"Robot control systems can range from simple open-loop commands to complex hierarchical architectures involving perception, planning, and feedback. Understanding these architectures is key to designing effective robot behaviors."}),"\n",(0,t.jsx)(o.h3,{id:"open-loop-control",children:"Open-Loop Control"}),"\n",(0,t.jsx)(o.p,{children:"In open-loop control, commands are sent to the robot without using any sensor feedback to verify if the desired state has been achieved. It's simple but prone to errors due to disturbances or inaccurate models."}),"\n",(0,t.jsxs)(o.ul,{children:["\n",(0,t.jsxs)(o.li,{children:[(0,t.jsx)(o.strong,{children:"Example"}),": Sending a fixed velocity command to a motor for a set duration, assuming it will travel a certain distance."]}),"\n"]}),"\n",(0,t.jsx)(o.h3,{id:"closed-loop-control-feedback-control",children:"Closed-Loop Control (Feedback Control)"}),"\n",(0,t.jsx)(o.p,{children:"Closed-loop control uses sensor feedback to compare the robot's actual state with its desired state. The difference (error) is then used to adjust the control commands, allowing the robot to correct itself and achieve more robust performance."}),"\n",(0,t.jsxs)(o.ul,{children:["\n",(0,t.jsxs)(o.li,{children:[(0,t.jsx)(o.strong,{children:"Example"}),": Using wheel encoder feedback to precisely control the distance a mobile robot travels."]}),"\n"]}),"\n",(0,t.jsx)(o.h2,{id:"ros-2-control-stack-in-gazebo",children:"ROS 2 Control Stack in Gazebo"}),"\n",(0,t.jsxs)(o.p,{children:["ROS 2 provides a powerful control framework, ",(0,t.jsx)(o.code,{children:"ros2_control"}),", which simplifies the task of controlling robots with various hardware interfaces. In simulation, ",(0,t.jsx)(o.code,{children:"ros2_control"})," can interact with Gazebo's physics engine to actuate simulated joints and robots."]}),"\n",(0,t.jsx)(o.h3,{id:"key-components",children:"Key Components"}),"\n",(0,t.jsxs)(o.ul,{children:["\n",(0,t.jsxs)(o.li,{children:[(0,t.jsx)(o.strong,{children:"Controller Manager"}),": A central node that loads, starts, stops, and manages different robot controllers."]}),"\n",(0,t.jsxs)(o.li,{children:[(0,t.jsx)(o.strong,{children:"Hardware Interface"}),": Abstracts the robot's hardware (or simulated hardware in Gazebo), providing a consistent interface for controllers."]}),"\n",(0,t.jsxs)(o.li,{children:[(0,t.jsx)(o.strong,{children:"Controllers"}),": Implement specific control logic (e.g., Joint Trajectory Controller for manipulators, Diff Drive Controller for mobile robots)."]}),"\n"]}),"\n",(0,t.jsx)(o.h3,{id:"example-differential-drive-robot-control-conceptual",children:"Example: Differential Drive Robot Control (Conceptual)"}),"\n",(0,t.jsxs)(o.p,{children:["For a mobile robot with two driving wheels (differential drive), a common approach is to use a ",(0,t.jsx)(o.code,{children:"diff_drive_controller"}),". This controller subscribes to ",(0,t.jsx)(o.code,{children:"cmd_vel"})," messages (linear and angular velocity) and publishes ",(0,t.jsx)(o.code,{children:"odom"})," (odometry) information."]}),"\n",(0,t.jsx)(o.h2,{id:"implementing-basic-open-loop-control",children:"Implementing Basic Open-Loop Control"}),"\n",(0,t.jsx)(o.h3,{id:"sending-velocity-commands-conceptual-ros-2-publisher",children:"Sending Velocity Commands (Conceptual ROS 2 Publisher)"}),"\n",(0,t.jsxs)(o.p,{children:["To move a simulated differential drive robot, we can publish ",(0,t.jsx)(o.code,{children:"geometry_msgs/msg/Twist"})," messages to its ",(0,t.jsx)(o.code,{children:"cmd_vel"})," topic."]}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-python",children:"# conceptual_cmd_vel_publisher.py\r\n\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom geometry_msgs.msg import Twist\r\nimport time\r\n\r\nclass CmdVelPublisher(Node):\r\n\r\n    def __init__(self):\r\n        super().__init__('cmd_vel_publisher')\r\n        self.publisher_ = self.create_publisher(Twist, '/cmd_vel', 10)\r\n        self.timer = self.create_timer(0.1, self.publish_cmd_vel)\r\n        self.get_logger().info('CmdVel Publisher has started.')\r\n\r\n    def publish_cmd_vel(self):\r\n        twist = Twist()\r\n        twist.linear.x = 0.2  # Move forward at 0.2 m/s\r\n        twist.angular.z = 0.0 # No rotation\r\n        self.publisher_.publish(twist)\r\n        self.get_logger().info(f'Publishing linear: {twist.linear.x}, angular: {twist.angular.z}')\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = CmdVelPublisher()\r\n    rclpy.spin_once(node, timeout_sec=1.0) # Publish for a short duration\r\n    node.destroy_node()\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,t.jsx)(o.p,{children:"This simple publisher sends a constant forward velocity command. The robot will move until the node is shut down or stops publishing."}),"\n",(0,t.jsx)(o.h2,{id:"utilizing-ros-2-controllers-in-gazebo",children:"Utilizing ROS 2 Controllers in Gazebo"}),"\n",(0,t.jsxs)(o.p,{children:["To use ",(0,t.jsx)(o.code,{children:"ros2_control"})," in Gazebo, your robot's URDF/SDF needs to include specific tags to define its hardware interface and link to controller configurations. You then launch the Gazebo simulation and the ",(0,t.jsx)(o.code,{children:"ros2_control"})," controller manager, followed by spawning the desired controllers."]}),"\n",(0,t.jsx)(o.h3,{id:"steps-for-controller-integration-conceptual",children:"Steps for Controller Integration (Conceptual)"}),"\n",(0,t.jsxs)(o.ol,{children:["\n",(0,t.jsxs)(o.li,{children:[(0,t.jsx)(o.strong,{children:"URDF/SDF Modification"}),": Add ",(0,t.jsx)(o.code,{children:"<ros2_control>"})," tags to your robot model, specifying interfaces (e.g., ",(0,t.jsx)(o.code,{children:"JointStateInterface"}),", ",(0,t.jsx)(o.code,{children:"VelocityJointInterface"}),")."]}),"\n",(0,t.jsxs)(o.li,{children:[(0,t.jsx)(o.strong,{children:"Controller Configuration"}),": Create YAML files defining the parameters for your ",(0,t.jsx)(o.code,{children:"diff_drive_controller"})," or ",(0,t.jsx)(o.code,{children:"joint_trajectory_controller"}),"."]}),"\n",(0,t.jsxs)(o.li,{children:[(0,t.jsx)(o.strong,{children:"Launch Files"}),": Use ROS 2 launch files to:","\n",(0,t.jsxs)(o.ul,{children:["\n",(0,t.jsx)(o.li,{children:"Start Gazebo with your robot."}),"\n",(0,t.jsxs)(o.li,{children:["Spawn the ",(0,t.jsx)(o.code,{children:"ros2_control"})," controller manager."]}),"\n",(0,t.jsx)(o.li,{children:"Load and activate your specific robot controllers."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(o.h2,{id:"interpreting-sensor-feedback-for-simple-closed-loop-control",children:"Interpreting Sensor Feedback for Simple Closed-Loop Control"}),"\n",(0,t.jsxs)(o.p,{children:["For closed-loop control, a node subscribes to sensor feedback (e.g., ",(0,t.jsx)(o.code,{children:"odom"})," for mobile robots, joint states for manipulators) and adjusts commands based on the desired state."]}),"\n",(0,t.jsx)(o.h3,{id:"odometry-subscriber-conceptual-ros-2-subscriber",children:"Odometry Subscriber (Conceptual ROS 2 Subscriber)"}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-python",children:"# conceptual_odom_subscriber.py\r\n\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom nav_msgs.msg import Odometry\r\n\r\nclass OdometrySubscriber(Node):\r\n\r\n    def __init__(self):\r\n        super().__init__('odometry_subscriber')\r\n        self.subscription = self.create_subscription(\r\n            Odometry,\r\n            '/odom',\r\n            self.odom_callback,\r\n            10)\r\n        self.subscription  # prevent unused variable warning\r\n        self.current_x = 0.0\r\n        self.current_y = 0.0\r\n\r\n    def odom_callback(self, msg):\r\n        self.current_x = msg.pose.pose.position.x\r\n        self.current_y = msg.pose.pose.position.y\r\n        self.get_logger().info(f'Current position: x={self.current_x:.2f}, y={self.current_y:.2f}')\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = OdometrySubscriber()\r\n    rclpy.spin(node)\r\n    node.destroy_node()\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,t.jsxs)(o.p,{children:["By combining the ",(0,t.jsx)(o.code,{children:"CmdVelPublisher"})," and ",(0,t.jsx)(o.code,{children:"OdometrySubscriber"})," into a single control node, one could implement a simple proportional controller to drive to a target position, adjusting velocity based on the error to the goal."]}),"\n",(0,t.jsx)(o.h2,{id:"summary",children:"Summary"}),"\n",(0,t.jsx)(o.p,{children:"This chapter laid the groundwork for controlling simulated robots. We differentiated between open-loop and closed-loop control, introduced the ROS 2 control stack for managing robot hardware interfaces and controllers in Gazebo, and provided conceptual examples for implementing basic control strategies. The principles learned here are transferable to more advanced control problems and real robot systems."}),"\n",(0,t.jsx)(o.h2,{id:"exercises",children:"Exercises"}),"\n",(0,t.jsxs)(o.ol,{children:["\n",(0,t.jsxs)(o.li,{children:[(0,t.jsx)(o.strong,{children:"PID Controller Research"}),": Research the basics of PID (Proportional-Integral-Derivative) control. Explain how a PID controller could be used to precisely control a robot's wheel velocity based on encoder feedback."]}),"\n",(0,t.jsxs)(o.li,{children:[(0,t.jsx)(o.strong,{children:"Go-to-Goal Node Design"}),': Design a ROS 2 Python node that implements a simple open-loop "go-to-goal" behavior for a differential drive robot in Gazebo. The node should publish ',(0,t.jsx)(o.code,{children:"Twist"})," messages to move the robot towards a fixed target point."]}),"\n",(0,t.jsxs)(o.li,{children:[(0,t.jsx)(o.strong,{children:"Integrated Control Node"}),": (Advanced) Combine the concepts from the ",(0,t.jsx)(o.code,{children:"CmdVelPublisher"})," and ",(0,t.jsx)(o.code,{children:"OdometrySubscriber"})," to create a single node that attempts a basic closed-loop control to reach a target (e.g., a specific X, Y coordinate), stopping when close enough."]}),"\n"]})]})}function h(e={}){const{wrapper:o}={...(0,i.R)(),...e.components};return o?(0,t.jsx)(o,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,o,n)=>{n.d(o,{R:()=>s,x:()=>l});var r=n(6540);const t={},i=r.createContext(t);function s(e){const o=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(o):{...o,...e}},[o,e])}function l(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),r.createElement(i.Provider,{value:o},e.children)}}}]);